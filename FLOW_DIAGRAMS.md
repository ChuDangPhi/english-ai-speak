# ðŸ“Š SYSTEM FLOW DIAGRAMS

## 1. OVERALL SYSTEM ARCHITECTURE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACE                          â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Topics   â”‚  â”‚ Lessons  â”‚  â”‚ Practice â”‚  â”‚ Progress â”‚      â”‚
â”‚  â”‚ Browser  â”‚â†’ â”‚   List   â”‚â†’ â”‚   Page   â”‚â†’ â”‚  Report  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FASTAPI BACKEND                            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  Topics    â”‚  â”‚  Lessons   â”‚  â”‚  Progress  â”‚               â”‚
â”‚  â”‚  Router    â”‚  â”‚  Router    â”‚  â”‚  Router    â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚         â†“                â†“                â†“                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ Vocabulary â”‚  â”‚Pronunciationâ”‚ â”‚Conversationâ”‚               â”‚
â”‚  â”‚  Service   â”‚  â”‚  Service   â”‚  â”‚  Service   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                â†“                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      EXTERNAL APIS                              â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚    DEEPGRAM API    â”‚           â”‚   OPENAI GPT-4   â”‚         â”‚
â”‚  â”‚                    â”‚           â”‚                  â”‚         â”‚
â”‚  â”‚  â€¢ STT (Speechâ†’    â”‚           â”‚  â€¢ Conversation  â”‚         â”‚
â”‚  â”‚    Text)           â”‚           â”‚  â€¢ Grammar Check â”‚         â”‚
â”‚  â”‚  â€¢ TTS (Textâ†’      â”‚           â”‚  â€¢ Feedback Gen  â”‚         â”‚
â”‚  â”‚    Speech)         â”‚           â”‚  â€¢ Scoring       â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MYSQL DATABASE                             â”‚
â”‚                                                                 â”‚
â”‚  Topics â†’ Lessons â†’ Exercises â†’ Attempts â†’ Results             â”‚
â”‚     â†“        â†“          â†“           â†“          â†“               â”‚
â”‚  Progress  Vocabulary  Audio    Feedback   Scores              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. LESSON TYPE FLOW COMPARISON

### A. VOCABULARY MATCHING FLOW
```
User                Frontend              Backend              Database
  â”‚                    â”‚                     â”‚                     â”‚
  â”‚ Click Lesson       â”‚                     â”‚                     â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                     â”‚                     â”‚
  â”‚                    â”‚ GET /vocabulary     â”‚                     â”‚
  â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                     â”‚
  â”‚                    â”‚                     â”‚ SELECT vocabulary   â”‚
  â”‚                    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
  â”‚                    â”‚                     â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
  â”‚                    â”‚ â† Vocabulary List   â”‚                     â”‚
  â”‚ â† Display Game     â”‚                     â”‚                     â”‚
  â”‚                    â”‚                     â”‚                     â”‚
  â”‚ Submit Answers     â”‚                     â”‚                     â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                     â”‚                     â”‚
  â”‚                    â”‚ POST /submit        â”‚                     â”‚
  â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                     â”‚
  â”‚                    â”‚                     â”‚ Check answers       â”‚
  â”‚                    â”‚                     â”‚ Calculate score     â”‚
  â”‚                    â”‚                     â”‚ INSERT attempt      â”‚
  â”‚                    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
  â”‚                    â”‚                     â”‚ UPDATE progress     â”‚
  â”‚                    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
  â”‚                    â”‚ â† Score + Feedback  â”‚                     â”‚
  â”‚ â† Show Results     â”‚                     â”‚                     â”‚
  â”‚                    â”‚                     â”‚                     â”‚
```

### B. PRONUNCIATION PRACTICE FLOW
```
User                Frontend              Backend              Deepgram          OpenAI
  â”‚                    â”‚                     â”‚                     â”‚               â”‚
  â”‚ Click Record       â”‚                     â”‚                     â”‚               â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                     â”‚                     â”‚               â”‚
  â”‚ ðŸŽ¤ Speak           â”‚                     â”‚                     â”‚               â”‚
  â”‚ "restaurant"       â”‚                     â”‚                     â”‚               â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                     â”‚                     â”‚               â”‚
  â”‚ Stop Recording     â”‚                     â”‚                     â”‚               â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                     â”‚                     â”‚               â”‚
  â”‚                    â”‚ POST /analyze       â”‚                     â”‚               â”‚
  â”‚                    â”‚ (audio file)        â”‚                     â”‚               â”‚
  â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                     â”‚               â”‚
  â”‚                    â”‚                     â”‚ Transcribe          â”‚               â”‚
  â”‚                    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚               â”‚
  â”‚                    â”‚                     â”‚ "restaurant"        â”‚               â”‚
  â”‚                    â”‚                     â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚               â”‚
  â”‚                    â”‚                     â”‚                     â”‚               â”‚
  â”‚                    â”‚                     â”‚ Analyze Pronunciation              â”‚
  â”‚                    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
  â”‚                    â”‚                     â”‚                     â”‚   GPT-4       â”‚
  â”‚                    â”‚                     â”‚                     â”‚   Scores:     â”‚
  â”‚                    â”‚                     â”‚                     â”‚   - Pronunc   â”‚
  â”‚                    â”‚                     â”‚                     â”‚   - Intonationâ”‚
  â”‚                    â”‚                     â”‚                     â”‚   - Stress    â”‚
  â”‚                    â”‚                     â”‚ â† Detailed Feedback               â”‚
  â”‚                    â”‚                     â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
  â”‚                    â”‚                     â”‚ Save to DB          â”‚               â”‚
  â”‚                    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚               â”‚
  â”‚                    â”‚ â† Scores + Tips     â”‚                     â”‚               â”‚
  â”‚ â† Display Results  â”‚                     â”‚                     â”‚               â”‚
  â”‚                    â”‚                     â”‚                     â”‚               â”‚
```

### C. AI CONVERSATION FLOW
```
User            Frontend          Backend         Deepgram        OpenAI          Database
  â”‚                â”‚                 â”‚                â”‚              â”‚                â”‚
  â”‚ Start Conv     â”‚                 â”‚                â”‚              â”‚                â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                 â”‚                â”‚              â”‚                â”‚
  â”‚                â”‚ POST /start     â”‚                â”‚              â”‚                â”‚
  â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                â”‚              â”‚                â”‚
  â”‚                â”‚                 â”‚ Create Attempt â”‚              â”‚                â”‚
  â”‚                â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
  â”‚                â”‚                 â”‚                â”‚              â”‚                â”‚
  â”‚                â”‚                 â”‚ Generate Greeting             â”‚                â”‚
  â”‚                â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                â”‚
  â”‚                â”‚                 â”‚                â”‚   GPT: "Good evening..."     â”‚
  â”‚                â”‚                 â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                â”‚
  â”‚                â”‚                 â”‚                â”‚              â”‚                â”‚
  â”‚                â”‚                 â”‚ Text â†’ Speech  â”‚              â”‚                â”‚
  â”‚                â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚              â”‚                â”‚
  â”‚                â”‚                 â”‚ â† Audio URL    â”‚              â”‚                â”‚
  â”‚                â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
  â”‚                â”‚ â† AI Message    â”‚ Save message   â”‚              â”‚                â”‚
  â”‚ ðŸ”Š Play Audio  â”‚ + Audio         â”‚                â”‚              â”‚                â”‚
  â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚                â”‚              â”‚                â”‚
  â”‚                â”‚                 â”‚                â”‚              â”‚                â”‚
  â”‚ ðŸŽ¤ User Reply  â”‚                 â”‚                â”‚              â”‚                â”‚
  â”‚ "I want..."    â”‚                 â”‚                â”‚              â”‚                â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                 â”‚                â”‚              â”‚                â”‚
  â”‚                â”‚ POST /respond   â”‚                â”‚              â”‚                â”‚
  â”‚                â”‚ (audio)         â”‚                â”‚              â”‚                â”‚
  â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                â”‚              â”‚                â”‚
  â”‚                â”‚                 â”‚ Speech â†’ Text  â”‚              â”‚                â”‚
  â”‚                â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚              â”‚                â”‚
  â”‚                â”‚                 â”‚ "I want pizza" â”‚              â”‚                â”‚
  â”‚                â”‚                 â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚              â”‚                â”‚
  â”‚                â”‚                 â”‚                â”‚              â”‚                â”‚
  â”‚                â”‚                 â”‚ Check Grammar  â”‚              â”‚                â”‚
  â”‚                â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                â”‚
  â”‚                â”‚                 â”‚ â† Grammar OK   â”‚              â”‚                â”‚
  â”‚                â”‚                 â”‚                â”‚              â”‚                â”‚
  â”‚                â”‚                 â”‚ Generate Reply â”‚              â”‚                â”‚
  â”‚                â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                â”‚
  â”‚                â”‚                 â”‚ "Great choice! Anything else?" â”‚                â”‚
  â”‚                â”‚                 â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                â”‚
  â”‚                â”‚                 â”‚                â”‚              â”‚                â”‚
  â”‚                â”‚                 â”‚ Text â†’ Speech  â”‚              â”‚                â”‚
  â”‚                â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚              â”‚                â”‚
  â”‚                â”‚                 â”‚ â† Audio        â”‚              â”‚                â”‚
  â”‚                â”‚                 â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚              â”‚                â”‚
  â”‚                â”‚                 â”‚ Save both messages            â”‚                â”‚
  â”‚                â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
  â”‚                â”‚ â† AI Response   â”‚                â”‚              â”‚                â”‚
  â”‚ ðŸ”Š Play        â”‚ + Audio         â”‚                â”‚              â”‚                â”‚
  â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚                â”‚              â”‚                â”‚
  â”‚                â”‚                 â”‚                â”‚              â”‚                â”‚
  â”‚ ... 5-10 turns ...               â”‚                â”‚              â”‚                â”‚
  â”‚                â”‚                 â”‚                â”‚              â”‚                â”‚
  â”‚ End Conv       â”‚                 â”‚                â”‚              â”‚                â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ POST /end       â”‚                â”‚              â”‚                â”‚
  â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                â”‚              â”‚                â”‚
  â”‚                â”‚                 â”‚ Analyze Full Conversation     â”‚                â”‚
  â”‚                â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                â”‚
  â”‚                â”‚                 â”‚ Scores: Grammar, Fluency, Overall             â”‚
  â”‚                â”‚                 â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                â”‚
  â”‚                â”‚                 â”‚ Update Progress               â”‚                â”‚
  â”‚                â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
  â”‚                â”‚ â† Final Report  â”‚                â”‚              â”‚                â”‚
  â”‚ â† Show Stats   â”‚                 â”‚                â”‚              â”‚                â”‚
  â”‚   & Feedback   â”‚                 â”‚                â”‚              â”‚                â”‚
```

---

## 3. DATABASE RELATIONSHIPS

```
users (id)
  â”‚
  â”œâ”€1:1â”€â†’ user_settings (user_id)
  â”‚
  â”œâ”€1:Nâ”€â†’ user_lesson_progress (user_id)
  â”‚         â”‚
  â”‚         â””â†’ lessons (id)
  â”‚               â”‚
  â”‚               â”œâ†’ topics (id)
  â”‚               â”‚
  â”‚               â”œâ”€1:Nâ”€â†’ lesson_vocabulary (lesson_id)
  â”‚               â”‚         â””â†’ vocabulary (id)
  â”‚               â”‚
  â”‚               â”œâ”€1:Nâ”€â†’ pronunciation_exercises (lesson_id)
  â”‚               â”‚
  â”‚               â””â”€1:1â”€â†’ conversation_templates (lesson_id)
  â”‚
  â””â”€1:Nâ”€â†’ lesson_attempts (user_id)
            â”‚
            â”œâ†’ lessons (id)
            â”‚
            â”œâ”€1:Nâ”€â†’ vocabulary_matching_results (lesson_attempt_id)
            â”‚         â””â†’ vocabulary (id)
            â”‚
            â”œâ”€1:Nâ”€â†’ pronunciation_attempts (lesson_attempt_id)
            â”‚         â””â†’ pronunciation_exercises (id)
            â”‚
            â””â”€1:Nâ”€â†’ conversation_messages (lesson_attempt_id)
```

---

## 4. SCORING SYSTEM

### Vocabulary Matching
```
Score = (Correct Answers / Total Questions) Ã— 100

Example:
3 correct out of 5 = (3/5) Ã— 100 = 60%
Pass threshold: 70%
```

### Pronunciation
```
Overall Score = (Pronunciation + Intonation + Stress) / 3

Where each component scored 0-100 by GPT-4:
- Pronunciation: Word accuracy
- Intonation: Rising/falling tones
- Stress: Syllable emphasis

Example:
Pronunciation: 85
Intonation: 78
Stress: 72
Overall: (85 + 78 + 72) / 3 = 78.3%
```

### Conversation
```
Overall Score = (Grammar Ã— 0.4) + (Fluency Ã— 0.3) + (Vocabulary Ã— 0.3)

Components (GPT-4 analysis):
- Grammar: Sentence structure accuracy
- Fluency: Natural flow, hesitations
- Vocabulary: Word choice appropriateness

Example:
Grammar: 80
Fluency: 85
Vocabulary: 75
Overall: (80Ã—0.4) + (85Ã—0.3) + (75Ã—0.3) = 79.5%
```

---

## 5. LESSON UNLOCK LOGIC

```
Lesson 1 (Vocabulary)
   â†“
   [Score â‰¥ 70%] â†’ Unlock Lesson 2
   â†“
Lesson 2 (Pronunciation)
   â†“
   [Score â‰¥ 70%] â†’ Unlock Lesson 3
   â†“
Lesson 3 (Conversation)
   â†“
   [Score â‰¥ 70%] â†’ Complete Topic â†’ Next Topic Available
```

**Database Query:**
```sql
-- Check if user can access lesson
SELECT 
  l.id,
  l.lesson_order,
  CASE 
    WHEN l.lesson_order = 1 THEN 'available'
    WHEN prev_lesson.best_score >= 70 THEN 'available'
    ELSE 'locked'
  END as status
FROM lessons l
LEFT JOIN (
  SELECT 
    lesson_id,
    MAX(overall_score) as best_score
  FROM lesson_attempts
  WHERE user_id = ? AND is_completed = TRUE
  GROUP BY lesson_id
) prev_lesson ON prev_lesson.lesson_id = (
  SELECT id FROM lessons 
  WHERE topic_id = l.topic_id 
  AND lesson_order = l.lesson_order - 1
)
WHERE l.topic_id = ?
ORDER BY l.lesson_order
```

---

## 6. DATA FLOW SUMMARY

```
INPUT â†’ PROCESSING â†’ OUTPUT

Vocabulary Matching:
Word pairs â†’ User selection â†’ Score + Correct answers

Pronunciation:
Audio recording â†’ Deepgram STT + GPT-4 analysis â†’ Scores (3 types) + Feedback

Conversation:
User audio â†’ Deepgram STT â†’ GPT-4 response â†’ Deepgram TTS â†’ AI audio
             â†“
         Grammar check â†’ Save to DB â†’ Continue loop
             â†“
         End â†’ Full analysis â†’ Final scores
```

---

CÃ³ cáº§n tÃ´i giáº£i thÃ­ch thÃªm pháº§n nÃ o khÃ´ng?
